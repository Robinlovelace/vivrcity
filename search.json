[{"path":"https://robinlovelace.github.io/vivrcity/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"First Last. Author, maintainer.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Last F (2025). vivrcity: Interface Vivacity Labs API. R package version 0.1.0.","code":"@Manual{,   title = {vivrcity: Interface to the Vivacity Labs API},   author = {First Last},   year = {2025},   note = {R package version 0.1.0}, }"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"vivrcity","dir":"","previous_headings":"","what":"Interface to the Vivacity Labs API","title":"Interface to the Vivacity Labs API","text":"goal vivrcity provide simple R interface Vivacity Labs API.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Interface to the Vivacity Labs API","text":"can install development version vivrcity GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"Robinlovelace/vivrcity\")"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"setup","dir":"","previous_headings":"","what":"Setup","title":"Interface to the Vivacity Labs API","text":"need Vivacity API key use package. Save .Renviron file:","code":"VIVACITY_API_KEY=your_api_key_here"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"Interface to the Vivacity Labs API","text":"example demonstrates retrieve metadata, counts, visualize traffic data. Load package: developing, clone repo following command: See GitHub CLI installation instructions install gh. open folder RStudio/VSCode/favourite IDE run:","code":"library(vivrcity) gh repo clone Robinlovelace/vivrcity devtools::load_all() #> ℹ Loading vivrcity"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"countline-metadata","dir":"","previous_headings":"","what":"Countline metadata","title":"Interface to the Vivacity Labs API","text":"countline dataset represented linestrings. visualisation can useful convert points: can visualise data favourite mapping package, e.g.: Note device typically 2 countlines (e.g. S38_in S38_out):","code":"library(dplyr) library(ggplot2)  # Get countline metadata (returns sf object) metadata_sf <- get_countline_metadata() names(metadata_sf) #>  [1] \"id\"                                 \"name\"                               #>  [3] \"sensor_name\"                        \"description\"                        #>  [5] \"direction\"                          \"is_dwell_times_filtering_countline\" #>  [7] \"is_anpr\"                            \"is_speed\"                           #>  [9] \"modified_at\"                        \"geometry\" metadata_points <- metadata_sf |>   sf::st_centroid() #> Warning: st_centroid assumes attributes are constant over geometries library(tmap) tmap_mode(\"view\") qtm(metadata_points) metadata_sf$id |>   duplicated() |>   summary() #>    Mode   FALSE  #> logical     434 # for name: metadata_sf$name |>   duplicated() |>   summary() #>    Mode   FALSE    TRUE  #> logical     430       4 # simplified name: metadata_sf$sensor_name |>   duplicated() |>   summary() #>    Mode   FALSE    TRUE  #> logical     248     186"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"getting-counts","dir":"","previous_headings":"","what":"Getting counts","title":"Interface to the Vivacity Labs API","text":"","code":"# Sample 3 random countlines and rename to A, B, C set.seed(2025) sampled_metadata <- metadata_sf |>   slice_sample(n = 3) |>   mutate(sensor = c(\"A\", \"B\", \"C\")) sampled_ids <- sampled_metadata$id id_lookup <- setNames(sampled_metadata$sensor, sampled_metadata$id)  # Get counts for a week in 2025 from_time <- as.POSIXct(\"2025-12-01\", tz = \"UTC\") to_time <- as.POSIXct(\"2025-12-17\", tz = \"UTC\")  # Get counts by mode/class (default with get_counts) counts <- get_counts(sampled_ids, from = from_time, to = to_time)  names(counts) #> [1] \"id\"          \"sensor_name\" \"name\"        \"from\"        \"to\"          #> [6] \"direction\"   \"class\"       \"count\"  # Plot pedestrians vs cyclists counts |>   filter(class %in% c(\"pedestrian\", \"cyclist\", \"car\")) |>   mutate(sensor = id_lookup[id]) |>   group_by(sensor, class, day = as.Date(from)) |>   summarise(count = sum(count, na.rm = TRUE), .groups = \"drop\") |>   ggplot(aes(x = day, y = count, color = class)) +   geom_line() +   facet_wrap(~sensor, ncol = 1) +   labs(     x = \"Date\",     y = \"Count\",     color = \"Mode\"   ) +   theme_minimal()"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"getting-speeds","dir":"","previous_headings":"","what":"Getting speeds","title":"Interface to the Vivacity Labs API","text":"Note: fail sensors don’t speed recording enabled:","code":"# Get speeds (function accepts vector of IDs) speeds_df <- get_countline_speed(sampled_ids, from = from_time, to = to_time)"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"aggregating-data","dir":"","previous_headings":"","what":"Aggregating data","title":"Interface to the Vivacity Labs API","text":"Sometimes might want aggregate data multiple countlines belong sensor (e.g. S38_in S38_out). package provides functions aggregate counts metadata. Aggregate metadata one row per sensor: Let’s plot results single sensor:","code":"# Aggregate counts (sums across directions for same ID) # Note: get_counts(..., aggregate = TRUE) does this automatically aggregated_counts <- aggregate_counts(counts) nrow(aggregated_counts) / nrow(counts) #> [1] 0.5 names(aggregated_counts) #> [1] \"sensor_name\" \"from\"        \"to\"          \"class\"       \"count\" # Aggregate metadata (returns sf object with one row per sensor) # Note: get_countline_metadata(aggregate = TRUE) does this automatically metadata_aggregated <- aggregate_metadata(metadata_sf) #> Warning: st_centroid assumes attributes are constant over geometries names(metadata_aggregated) #> [1] \"sensor_name\"  \"ids\"          \"names\"        \"n_countlines\" \"geometry\" nrow(metadata_sf) #> [1] 434 nrow(metadata_aggregated) #> [1] 245 summary(aggregated_counts$sensor_name %in% metadata_aggregated$sensor_name) #>    Mode    TRUE  #> logical     239 # Filter to single sensor single_sensor_id <- aggregated_counts$sensor_name[1] metadata_sensor_level <- metadata_aggregated |>   filter(sensor_name == single_sensor_id) |>   sf::st_centroid() metadata_count_level <- metadata_sf |>   filter(sensor_name == single_sensor_id)  # Verify countlines belong to same road: metadata_count_level$name #> [1] \"S58_LeedsRd_pathLHS_wyca001\" \"S58_LeedsRd_road_wyca001\" plot(metadata_count_level$geometry) plot(metadata_sensor_level$geometry, col = \"red\", pch = 19, add = TRUE)"},{"path":"https://robinlovelace.github.io/vivrcity/index.html","id":"next-steps","dir":"","previous_headings":"","what":"Next Steps","title":"Interface to the Vivacity Labs API","text":"package currently implements subset Vivacity Traffic Monitoring API. Future development include: Additional Countline Endpoints: - Journey times (/countline/journey_times) - requires ANPR-enabled sensors Zone-Based Data: - Zonal speeds (/zone/speeds) - Occupancy data (/zone/occupancy) - Turning movements (/zone/turning_movements) - Dwell times (/zone/dwell_times) Features: - Viewpoint metadata data availability - Zone metadata - Annotations support - V2 API endpoints projects positions Improvements: - Better error handling informative messages - Automatic pagination large queries - Caching metadata requests - Support vehicle/pedestrian class types Contributions welcome! See API documentation endpoint details.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_counts.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate Counts — aggregate_counts","title":"Aggregate Counts — aggregate_counts","text":"Aggregates count data. sums counts across directions (non-grouping columns) ID, time, class.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_counts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate Counts — aggregate_counts","text":"","code":"aggregate_counts(data)"},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_counts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate Counts — aggregate_counts","text":"data data frame counts, typically get_counts().","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_counts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate Counts — aggregate_counts","text":"data frame aggregated counts.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_counts.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Aggregate Counts — aggregate_counts","text":"attempts intelligently aggregate sensor checking sensor_name column (created get_counts()). sensor_name missing name present, derive sensor_name name. neither present, aggregates existing id.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate Metadata — aggregate_metadata","title":"Aggregate Metadata — aggregate_metadata","text":"Aggregates countline metadata simplifying countline names (extracting sensor ID) returning one row per sensor. combines original IDs names comma-separated strings counts number countlines per sensor.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_metadata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate Metadata — aggregate_metadata","text":"","code":"aggregate_metadata(metadata, centroids = TRUE)"},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_metadata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate Metadata — aggregate_metadata","text":"metadata sf object countline metadata, typically get_countline_metadata(). centroids Logical. TRUE (default), converts aggregated geometry centroids.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/aggregate_metadata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate Metadata — aggregate_metadata","text":"sf object aggregated metadata.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_all_countline_counts_annual.html","id":null,"dir":"Reference","previous_headings":"","what":"Retrieves count data for all available countlines over a one-year period. This function iterates through all countlines found in metadata and calls get_counts() for each, combining the results into a single data frame. — get_all_countline_counts_annual","title":"Retrieves count data for all available countlines over a one-year period. This function iterates through all countlines found in metadata and calls get_counts() for each, combining the results into a single data frame. — get_all_countline_counts_annual","text":"Retrieves count data available countlines one-year period. function iterates countlines found metadata calls get_counts() , combining results single data frame.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_all_countline_counts_annual.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Retrieves count data for all available countlines over a one-year period. This function iterates through all countlines found in metadata and calls get_counts() for each, combining the results into a single data frame. — get_all_countline_counts_annual","text":"","code":"get_all_countline_counts_annual(end_date = Sys.time(), time_bucket = \"24h\")"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_all_countline_counts_annual.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Retrieves count data for all available countlines over a one-year period. This function iterates through all countlines found in metadata and calls get_counts() for each, combining the results into a single data frame. — get_all_countline_counts_annual","text":"end_date end date one-year period (POSIXct object). Defaults current system time. time_bucket Time bucket size (e.g. \"1h\", \"5m\"). Defaults \"24h\".","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_all_countline_counts_annual.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Retrieves count data for all available countlines over a one-year period. This function iterates through all countlines found in metadata and calls get_counts() for each, combining the results into a single data frame. — get_all_countline_counts_annual","text":"data frame counts.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Countline Counts — get_countline_counts","title":"Get Countline Counts — get_countline_counts","text":"Get Countline Counts","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Countline Counts — get_countline_counts","text":"","code":"get_countline_counts(   countline_ids,   from,   to,   classes = NULL,   time_bucket = \"24h\",   wait = 1 )"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Countline Counts — get_countline_counts","text":"countline_ids Vector countline IDs. Start timestamp. End timestamp. classes Vector classes include. time_bucket Time bucket size (e.g. \"1h\", \"5m\"). Defaults \"24h\". wait Seconds wait API requests. Defaults 1.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Countline Counts — get_countline_counts","text":"Data frame counts.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts_by_class.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Countline Counts by Class/Mode — get_countline_counts_by_class","title":"Get Countline Counts by Class/Mode — get_countline_counts_by_class","text":"Returns counts broken transport class (pedestrian, cyclist, etc.)","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts_by_class.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Countline Counts by Class/Mode — get_countline_counts_by_class","text":"","code":"get_countline_counts_by_class(   countline_ids,   from,   to,   time_bucket = \"24h\",   wait = 1 )"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts_by_class.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Countline Counts by Class/Mode — get_countline_counts_by_class","text":"countline_ids Vector countline IDs. Start timestamp. End timestamp. time_bucket Time bucket size (e.g. \"1h\", \"5m\"). Defaults \"24h\". wait Seconds wait API requests. Defaults 1.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_counts_by_class.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Countline Counts by Class/Mode — get_countline_counts_by_class","text":"Data frame counts class long format.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Countline Metadata — get_countline_metadata","title":"Get Countline Metadata — get_countline_metadata","text":"Get Countline Metadata","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_metadata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Countline Metadata — get_countline_metadata","text":"","code":"get_countline_metadata()"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_speed.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Countline Speeds — get_countline_speed","title":"Get Countline Speeds — get_countline_speed","text":"Get Countline Speeds","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_speed.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Countline Speeds — get_countline_speed","text":"","code":"get_countline_speed(countline_ids, from, to, time_bucket = \"24h\")"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_speed.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Countline Speeds — get_countline_speed","text":"countline_ids Vector countline IDs. Start timestamp. End timestamp. time_bucket Time bucket size (e.g. \"1h\", \"5m\"). Defaults \"24h\".","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_countline_speed.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Countline Speeds — get_countline_speed","text":"Data frame speeds.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_counts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Countline Counts — get_counts","title":"Get Countline Counts — get_counts","text":"Simple wrapper get countline counts class breakdown default. recommended function use cases. automatically fetches metadata add name sensor_name columns, enabling easier aggregation sensor.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_counts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Countline Counts — get_counts","text":"","code":"get_counts(   countline_ids,   from,   to,   by_class = TRUE,   split_direction = TRUE,   aggregate = FALSE,   time_bucket = \"24h\",   wait = 1 )"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_counts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Countline Counts — get_counts","text":"countline_ids Vector countline IDs. Start timestamp. End timestamp. by_class TRUE (default), returns counts broken transport class (pedestrian, cyclist, etc.) long format. FALSE, returns total counts . split_direction TRUE (default), preserves direction information. FALSE, sums counts across directions. aggregate TRUE, aggregates results sensor (summing directions combining countlines belonging sensor). Defaults FALSE. time_bucket Time bucket size (e.g. \"1h\", \"5m\"). Defaults \"24h\". wait Seconds wait API requests. Defaults 1.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_counts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Countline Counts — get_counts","text":"data frame columns id, sensor_name, name, , , class, direction, count. by_class FALSE, class \"\". split_direction FALSE, direction column omitted (counts summed). aggregate TRUE, id column contain sensor name, direction name columns removed.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_hardware_metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Hardware Metadata — get_hardware_metadata","title":"Get Hardware Metadata — get_hardware_metadata","text":"Get Hardware Metadata","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_hardware_metadata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Hardware Metadata — get_hardware_metadata","text":"","code":"get_hardware_metadata()"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_journey_times.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Journey Times — get_journey_times","title":"Get Journey Times — get_journey_times","text":"Get Journey Times","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_journey_times.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Journey Times — get_journey_times","text":"","code":"get_journey_times(origin_id, dest_id, from, to)"},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_journey_times.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Journey Times — get_journey_times","text":"origin_id Origin countline ID. dest_id Destination countline ID. Start timestamp. End timestamp.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/get_journey_times.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Journey Times — get_journey_times","text":"Data frame journey times.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/name_simplify.html","id":null,"dir":"Reference","previous_headings":"","what":"Simplify Countline Name — name_simplify","title":"Simplify Countline Name — name_simplify","text":"Extracts unique sensor component countline name. Assumes format \"SensorID_Location_...\".","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/name_simplify.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simplify Countline Name — name_simplify","text":"","code":"name_simplify(name)"},{"path":"https://robinlovelace.github.io/vivrcity/reference/name_simplify.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simplify Countline Name — name_simplify","text":"name character vector countline names.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/name_simplify.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simplify Countline Name — name_simplify","text":"character vector simplified names.","code":""},{"path":"https://robinlovelace.github.io/vivrcity/reference/name_simplify.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simplify Countline Name — name_simplify","text":"","code":"name_simplify(\"S38_eastgate_crossing_lpti\") #> [1] \"S38_eastgate\""}]
